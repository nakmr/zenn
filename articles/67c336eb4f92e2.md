---
title: "é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’Pythonã§å®Ÿè·µã—ã¦ã¿ã‚ˆã†"
emoji: "ğŸ˜Š"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Python, é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°, OpenAI]
published: false
publication_name: "acntechjp"
---

<!-- textlint-disable -->
:::details change log
<!-- textlint-enable -->
2024/09/17 æŠ•ç¨¿
<!-- textlint-disable -->
:::
<!-- textlint-enable -->

# ã¯ã˜ã‚ã«

æœ¬è¨˜äº‹ã§ã¯ã€é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®åŸºæœ¬çš„ãªæ¦‚å¿µã‚’æ•´ç†ã—ã¦ã€Pythonã‚’ä½¿ã£ã¦é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’å®Ÿè·µã—ã¾ã™ã€‚

æœ¬è¨˜äº‹ã®åœŸå°ã¯ã€ç­†è€…ãŒé–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã«ã¤ã„ã¦å­¦ç¿’/æ•´ç†ã—ãŸå†…å®¹ãªã®ã§ã€é«˜åº¦ã«å°‚é–€çš„ã§ã¯ãªã„ã“ã¨ã‚„ã€å®Ÿè·µã®éç¨‹ã§ã‚ã‚‹ã“ã¨ã«ç•™æ„ãã ã•ã„ã€‚


## èª°ã«å‘ã‘ãŸè¨˜äº‹ã‹

æœ¬è¨˜äº‹ã¯ã€ã“ã‚“ãªäººã«å‘ã‘ã¦æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚

- é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ãŒã©ã‚“ãªã‚‚ã®ã‹ã€è§¦ã‚Šã§ã„ã„ã‹ã‚‰çŸ¥ã‚ŠãŸã„äºº
- Pythonã§é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’å®Ÿè·µã™ã‚‹ã¨ã€ã©ã‚“ãªé¢¨ã«ãªã‚‹ã®ã‹çŸ¥ã‚ŠãŸã„äºº
- ã“ã“ã¾ã§èª­ã‚“ã§ã€ãªã‚“ã‹æ°—ã«ãªã£ã¦ã—ã¾ã£ãŸäºº


## èª°ã«å‘ã‘ãŸè¨˜äº‹ã§ã¯ãªã„ã‹

æœ¬è¨˜äº‹ã¯ã€ã“ã‚“ãªäººãŒèª­ã‚€ã¨ã€Œè‡ªåˆ†å‘ã‘ã˜ã‚ƒãªã‹ã£ãŸã€ã€ã€ã€ã¨ãªã‚Šã¾ã™ã€‚

- æ•°å­¦çš„ã«å³å¯†ãªé–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’æ›¸ããŸã„äºº
- ã‚‚ã†ã™ã§ã«é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’å®Ÿè·µã—ã¦ã„ã¦ã€ã•ã‚‰ã«ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã—ãŸã„ã¨è€ƒãˆã¦ã„ã‚‹äºº

## æœ¬è¨˜äº‹ã®æ¦‚è¦

æœ¬è¨˜äº‹ã§ã¯ã€ç”ŸæˆAIã¨ãƒãƒ£ãƒƒãƒˆã™ã‚‹æ©Ÿèƒ½ã‚’é¡Œæã«ã€Pythonã‚’ä½¿ã£ã¦é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’å®Ÿè·µã—ã¾ã™ã€‚
ã¾ãšã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ãªæ›¸ãæ–¹ã§æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã€é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®è¦³ç‚¹ã‹ã‚‰ã¯ã©ã†ã„ã£ãŸç‚¹ãŒå•é¡Œã«ãªã‚‹ã®ã‹ã‚’ç¢ºèªã—ãŸå¾Œã€åŒæ©Ÿèƒ½ã‚’é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã§æ›¸ãç›´ã—ã¾ã™ã€‚

## æœ¬è¨˜äº‹ã‚’èª­ã‚“ã å¾Œã«ã©ã†ãªã‚‹ã‹

æœ¬è¨˜äº‹ã‚’èª­ã¿çµ‚ã‚ã‚‹ã¨ã€ã‚ãªãŸã¯ã“ã®ã‚ˆã†ãªçŠ¶æ…‹ã«ãªã£ã¦ã„ã¾ã™ã€‚

- é–¢æ•°ã®ã‚·ã‚°ãƒãƒãƒ£ã«ã€ãã®é–¢æ•°ã«é–¢ã™ã‚‹ã“ã¨å…¨ã¦ãŒè¡¨ã‚Œã¦ã„ã‚‹ã€Œå˜˜ã‚’ã¤ã‹ãªã„é–¢æ•°ã€ã®é‡è¦ã•ã‚’èª¬æ˜ã§ãã‚‹
- èª­ã‚€å‰ã‚ˆã‚Šã‚‚ã€é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¸ã®èˆˆå‘³ãŒå¼·ããªã£ã¦ã„ã‚‹
- ä½•ãªã‚‰ã€å¥½ãã«ãªã£ã¦ã„ã‚‹

## ä½•ã‚’å®Ÿè£…ã™ã‚‹ã®ã‹

æœ¬è¨˜äº‹ã§ã¯OpenAI APIã‚’åˆ©ç”¨ã—ãŸLLMã¨ã®ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã¯ä¸‹è¨˜ã®è¦ä»¶ã‚’æº€ãŸã™ã‚‚ã®ã¨ã—ã¾ã™ã€‚

- ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã®UIã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¨ã™ã‚‹
- ãƒãƒ£ãƒƒãƒˆã‚’é–‹å§‹ã™ã‚‹ã¨ãƒ¦ãƒ¼ã‚¶ãŒçµ‚äº†ã‚’è¦æ±‚ã™ã‚‹ã¾ã§ã€ãƒãƒ£ãƒƒãƒˆãŒç¶™ç¶šã™ã‚‹
- 1å›ã®ãƒãƒ£ãƒƒãƒˆé–‹å§‹ã‹ã‚‰çµ‚äº†ã¾ã§ã®ä¼šè©±å±¥æ­´ã¯ã€å…¨ã¦LLMã«é€ä¿¡ã™ã‚‹
  - ãŸã ã—ã€ç°¡å˜ã®ãŸã‚ã€ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã®èª¿æ•´ã¯è¡Œã‚ãªã„


# ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ãªæ›¸ãæ–¹

ã¾ãšã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ãªæ›¸ãæ–¹ã§ã€ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã®åŸºæœ¬çš„ãªè€ƒãˆæ–¹ã¯ã€å½¹å‰²ã”ã¨ã«ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã€ãã®ã‚¯ãƒ©ã‚¹ãŒï¼ˆå½¹å‰²ã‚’æ‹…ã†ãŸã‚ã«ï¼‰å¿…è¦ã¨ã™ã‚‹å‡¦ç†ï¼ˆãƒ¡ã‚½ãƒƒãƒ‰ï¼‰ã‚’ã‚¯ãƒ©ã‚¹å†…ã«å®Ÿè£…ã—ã¾ã™ã€‚
æœ¬è¨˜äº‹ã§ã¯`ChatBot`ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã€ã“ã®ã‚¯ãƒ©ã‚¹å†…ã«ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚


```python:oop.py
import httpx
from typing import Dict, Any, Optional, List


class ChatBot:
    def __init__(self, api_key: str):
        """
        ChatBotã‚¯ãƒ©ã‚¹ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã€‚APIã‚­ãƒ¼ã‚’è¨­å®šã—ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚

        Args:
            api_key (str): OpenAI APIã‚­ãƒ¼ã€‚
        """
        self.api_key = api_key
        self.messages = []  # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ã‚’ä¿æŒã™ã‚‹ãƒªã‚¹ãƒˆ

    def _create_and_send_message(self, user_message: str) -> str:
        """
        ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’åŸºã«OpenAIã¨ã‚„ã‚Šå–ã‚Šã—ã€ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å–å¾—ã—ã¾ã™ã€‚

        Args:
            user_message (str): ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€‚

        Returns:
            Optional[str]: ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€‚å¤±æ•—ã—ãŸå ´åˆã¯Noneã€‚
        """
        # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ 
        self.messages.append({"role": "user", "content": user_message})

        # OpenAI APIã«é€ä¿¡ã™ã‚‹ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’ä½œæˆ
        payload = {
            "model": "gpt-4o",
            "messages": self.messages,
            "temperature": 0.7,
        }

        # OpenAI APIã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
        url = "https://api.openai.com/v1/chat/completions"
        headers = {"Authorization": f"Bearer {self.api_key}", "Content-Type": "application/json"}

        try:
            response = httpx.post(url=url, headers=headers, json=payload, timeout=None)
            data = response.raise_for_status().json()
        except httpx.HTTPStatusError as exc:
            print(
                f"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰: {exc.response.status_code}, ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: {exc.response.text}"
            )

        # ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å–å¾—ã—ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ã«è¿½åŠ 
        assistant_message = data["choices"][0]["message"]["content"]
        self.messages.append({"role": "assistant", "content": assistant_message})

        return assistant_message

    def start_chat(self) -> None:
        """
        LLMã¨ã®ãƒãƒ£ãƒƒãƒˆã‚’é–‹å§‹ã—ã¾ã™ã€‚
        """
        while True:
            user_message = input("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (`/end` ã§çµ‚äº†): ")
            if user_message == "/end":
                break

            assistant_message = self._create_and_send_message(user_message)
            if assistant_message:
                print(f"LLM: {assistant_message}")


if __name__ == "__main__":
    import os
    from dotenv import load_dotenv

    load_dotenv()
    chatbot = ChatBot(api_key=os.getenv("OPENAI_API_KEY"))
    chatbot.start_chat()
```

:::message
OpenAI APIã®åˆ©ç”¨ã«ã¯Pythonç”¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«`openai`ã‚’åˆ©ç”¨ã™ã‚‹ã®ãŒå¸¸å¥—æ‰‹æ®µã§ã™ãŒã€æœ¬è¨˜äº‹ã§ã¯ã€HTTPé€šä¿¡ã«é–¢ã‚ã‚‹ä¾‹å¤–å‡¦ç†ã«ã¤ã„ã¦è¨€åŠã™ã‚‹ãŸã‚ã«ã€ã‚ãˆã¦åˆ©ç”¨ã—ã¾ã›ã‚“ã€‚
<!-- textlint-disable -->
:::
<!-- textlint-enable -->

<!-- textlint-disable -->
:::details å®Ÿè¡Œçµæœã®ä¾‹
<!-- textlint-enable -->
```bash
ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (`/end` ã§çµ‚äº†): ä»Šæ±äº¬ã«ã„ã‚‹ã‚“ã ã‘ã©ã€ã‚ã¡ã‚ƒæš‘ã„ã£ã™
LLM: æ±äº¬ã®å¤ã¯ç¢ºã‹ã«æš‘ã„ã§ã™ã­ï¼æ¹¿åº¦ã‚‚é«˜ã„ã®ã§ã€ä½“æ„Ÿæ¸©åº¦ãŒã•ã‚‰ã«ä¸ŠãŒã‚Šã¾ã™ã€‚æ°´åˆ†ã‚’ã“ã¾ã‚ã«æ‘‚ã‚‹ã“ã¨ã€æ—¥é™°ã‚„å†·æˆ¿ã®åŠ¹ã„ãŸå ´æ‰€ã§ä¼‘ã‚€ã“ã¨ãŒå¤§åˆ‡ã§ã™ã€‚ã‚‚ã—å¤–å‡ºã™ã‚‹ãªã‚‰ã€å¸½å­ã‚„æ—¥å‚˜ã‚’ä½¿ã£ã¦æ—¥å·®ã—ã‚’é¿ã‘ã‚‹ã¨å°‘ã—æ¥½ã«ãªã‚Šã¾ã™ã‚ˆã€‚ã¾ãŸã€å†·ãŸã„é£²ã¿ç‰©ã‚„ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ ã‚’æ¥½ã—ã‚€ã®ã‚‚ã„ã„ã§ã™ã­ã€‚æœ¬å½“ã«æš‘ã„æ—¥ã¯ã€ç„¡ç†ã›ãšæ¶¼ã—ã„å ´æ‰€ã§éã”ã™ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚ä½“èª¿ã«ã¯æ°—ã‚’ã¤ã‘ã¦ãã ã•ã„ã­ï¼
ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (`/end` ã§çµ‚äº†): ä»Šåƒ•ã¯ã©ã“ã«ã„ã‚‹ã‚“ã ã£ã‘ï¼Ÿ
LLM: ã‚ãªãŸã¯ã€Œä»Šæ±äº¬ã«ã„ã‚‹ã€ã¨ãŠã£ã—ã‚ƒã£ã¦ã„ã¾ã—ãŸã­ã€‚æ±äº¬ã®ã©ã®ã‚¨ãƒªã‚¢ã«ã„ã‚‹ã‹ã¾ã§ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ãŒã€æ±äº¬ã®æš‘ã•ã«ã¯æ°—ã‚’ã¤ã‘ã¦éã”ã—ã¦ãã ã•ã„ã€‚ã‚‚ã—å…·ä½“çš„ãªå ´æ‰€ã‚„ãŠã™ã™ã‚ã®ã‚¹ãƒãƒƒãƒˆã«ã¤ã„ã¦çŸ¥ã‚ŠãŸã„ã“ã¨ãŒã‚ã‚Œã°ã€æ•™ãˆã¦ãã ã•ã„ï¼
ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (`/end` ã§çµ‚äº†): /end
```
<!-- textlint-disable -->
:::
<!-- textlint-enable -->


# é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®è¦³ç‚¹ã§ãƒ„ãƒƒã‚³ãƒŸã‚’å…¥ã‚Œã¦ã¿ã‚ˆã†

ã„ã£ãŸã‚“ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã‚’å¿µé ­ã«ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã‚’å®Ÿè£…ã—ãŸã¨ã“ã‚ã€Pythonã‚³ãƒ¼ãƒ‰ã«ã€é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®è¦³ç‚¹ã‹ã‚‰ãƒ„ãƒƒã‚³ãƒŸã‚’å…¥ã‚Œã¦ã¿ã¾ã—ã‚‡ã†ã€‚
ãƒ„ãƒƒã‚³ãƒŸã‚’å…¥ã‚Œã‚‹ãŸã‚ã«ã¯ã€æœ¬è¨˜äº‹ã«ãŠã‘ã‚‹ã€Œé–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¨ã¯ãªã‚“ãã‚„ã€ãŒå¿…è¦ã«ãªã‚‹ã®ã§ã€ã“ã“ã§å®šç¾©ã—ã¾ã™ã€‚


## æœ¬è¨˜äº‹ã«ãŠã‘ã‚‹é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¨ã¯ï¼Ÿ

æœ¬è¨˜äº‹ã§é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’å®Ÿè·µã™ã‚‹ã«ã‚ãŸã£ã¦ã€ã€Œ[ãªã£ã¨ãï¼é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°](https://www.shoeisha.co.jp/book/detail/9784798179803)ã€ã‹ã‚‰ã€ä¸‹è¨˜ã®ç”¨èªã¨å®šç¾©ã‚’æ‹å€Ÿã—ã¾ã™ã€‚

**é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°**

> é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¨ã¯ ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªå€¤ã‚’æ“ä½œã™ã‚‹ç´”ç²‹é–¢æ•°ã‚’åˆ©ç”¨ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã§ã‚ã‚‹ (P.70)

**ç´”ç²‹é–¢æ•°**

> - æˆ»ã‚Šå€¤ã¯1ã¤ã ã‘
> - å¼•æ•°ã®ã¿ã«åŸºã¥ã„ã¦æˆ»ã‚Šå€¤ã‚’è¨ˆç®—ã™ã‚‹
> - æ—¢å­˜ã®å€¤ã‚’å¤‰æ›´ã—ãªã„
> 
> (P.46)

ã¾ãŸåŒæ›¸ã§ã¯ã€ç´”ç²‹é–¢æ•°ã®å®šç¾©ã€Œå¼•æ•°ã«ã®ã¿åŸºã¥ã„ã¦æˆ»ã‚Šå€¤ã‚’è¨ˆç®—ã™ã‚‹ã€ã‹ã‚‰ã€ã€Œé–¢æ•°ã®ã‚·ã‚°ãƒãƒãƒ£ã¯å˜˜ã‚’ã¤ã„ã¦ã¯ã„ã‘ãªã„ã€ã¨ã—ã¦ã„ã¾ã™ã€‚
é–¢æ•°ã®ã‚·ã‚°ãƒãƒãƒ£ã¨ã¯é–¢æ•°åã€å¼•æ•°ã€æˆ»ã‚Šå€¤ã‚’è¡¨ã™éƒ¨åˆ†ã‚’æŒ‡ã—ã¾ã™ã€‚

```python
def add_two_numbers(num1: int, num2: int) -> int: # <- ã‚·ã‚°ãƒãƒãƒ£
    return num1 + num2 # <- æœ¬ä½“ï¼ˆé–¢æ•°ã®å®Ÿä½“ï¼‰
```

ã€Œé–¢æ•°ã®ã‚·ã‚°ãƒãƒãƒ£ã¯å˜˜ã‚’ã¤ãã€ã¨ã¯ã€é–¢æ•°ãŒã‚·ã‚°ãƒãƒãƒ£ã«æ›¸ã„ã¦ã‚ã‚‹å¼•æ•°ä»¥å¤–ã‚’åˆ©ç”¨ã—ãŸè¨ˆç®—ã‚’è¡Œã£ã¦ã„ãŸã‚Šã€æˆ»ã‚Šå€¤ä»¥å¤–ã‚’è¿”ã™ï¼ˆä¾‹ãˆã°ã€ä¾‹å¤–ã®ã‚¹ãƒ­ãƒ¼ï¼‰ã“ã¨ã‚’æŒ‡ã—ã¦ã„ã¾ã™ã€‚
è¨€ã„æ›ãˆã‚‹ã¨ã€ãã®é–¢æ•°ãŒä½•ã‚’ã™ã‚‹ã®ã‹ã¯ã‚·ã‚°ãƒãƒãƒ£ã«å…¨ã¦æ›¸ã„ã¦ã‚ã‚‹ã¹ãã§ã‚ã‚Šã€ã‚·ã‚°ãƒãƒãƒ£ã‹ã‚‰èª­ã¿å–ã‚Œãªã„å‡¦ç†ã‚’é–¢æ•°ã¯è¡Œã£ã¦ã¯ã„ã‘ãªã„ã€ã¨ã„ã†ã“ã¨ã‚’æ„å‘³ã—ã¦ã„ã¾ã™ã€‚

ä¾‹ãˆã°ä¸Šè¨˜é–¢æ•°`add_two_numbers`ã®ã‚·ã‚°ãƒãƒãƒ£ã‹ã‚‰ã¯ã€ã€Œå¼•æ•°ã«ã‚ã‚‹2ã¤ã®æ•´æ•°ï¼ˆ`int`å‹ï¼‰ã‚’è¶³ã—ãŸçµæœï¼ˆ`int`å‹ã§ã‚ã‚Šã€1ã¤ï¼‰ã‚’è¿”ã™ã€ã“ã¨ãŒå®¹æ˜“ã«èª­ã¿å–ã‚Œã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã“ã®é–¢æ•°ã®ã‚·ã‚°ãƒãƒãƒ£ã¯å˜˜ã¤ãã§ãªã„ã¨è¨€ãˆã¾ã™ã€‚

æœ¬è¨˜äº‹ã§é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’å®Ÿè·µã™ã‚‹ã«ã‚ãŸã£ã¦ã€ã“ã®æŒ‡æ‘˜ã‚‚é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®è¦³ç‚¹ã«åŠ ãˆã¾ã™ã€‚


## é–¢æ•°å‹ãƒ„ãƒƒã‚³ãƒŸ

`ChatBot`ã‚¯ãƒ©ã‚¹ã®å„ãƒ¡ã‚½ãƒƒãƒ‰ã«å¯¾ã—ã¦é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®è¦³ç‚¹ã‹ã‚‰ãƒ„ãƒƒã‚³ãƒŸã‚’å…¥ã‚Œã¦ã„ãã¾ã—ã‚‡ã†ã€‚

### `def __init__(self, api_key: str):`

<!-- textlint-disable -->
:::message
<!-- textlint-enable -->
ã“ã‚Œã¯ã‚¯ãƒ©ã‚¹ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã™ã‚‹éš›ã«å®Ÿè¡Œã•ã‚Œã‚‹ç‰¹æ®Šãƒ¡ã‚½ãƒƒãƒ‰ã®ãŸã‚ã€é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®è¦³ç‚¹ã§ãƒ„ãƒƒã‚³ãƒŸã‚’å…¥ã‚Œã‚‹ã¹ããªã®ã‹åˆ¤æ–­ã«è¿·ã„ã¾ã™ãŒã€ã‚„ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
<!-- textlint-disable -->
:::
<!-- textlint-enable -->

ã‚¯ãƒ©ã‚¹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã—ã¦ä¼šè©±å±¥æ­´ã‚’ä¿æŒã™ã‚‹ãƒªã‚¹ãƒˆ`self.messages = []`ã‚’å®£è¨€ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªãƒªã‚¹ãƒˆã®ãŸã‚ã€é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®å®šç¾©ã€Œã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªå€¤ã‚’æ“ä½œã™ã‚‹ã€ã«åã—ã¾ã™ã€‚
é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã«æ›¸ãç›´ã™ã«ã‚ãŸã£ã¦ã¯ã€ä¼šè©±å±¥æ­´ãŒå¢—ãˆã‚‹ãŸã³ã«1ã¤ã®ãƒªã‚¹ãƒˆã«ä¼šè©±å±¥æ­´ã‚’è¿½åŠ ã—ã¦ã„ãã®ã§ã¯ãªãã€ä¼šè©±å±¥æ­´ãŒè¿½åŠ ã•ã‚ŒãŸã€æ–°ã—ã„ãƒªã‚¹ãƒˆã‚’è¿”ã™ã‚ˆã†ã«æ›¸ãç›´ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### `def _create_and_send_message(self, user_message: str) -> str:`






### `def start_chat(self) -> None:`


# é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ãªæ›¸ãæ–¹



<!-- textlint-disable -->
:::details ã‚³ãƒ¼ãƒ‰ã®å…¨ä½“
<!-- textlint-enable -->
```python:fp.py
import httpx
from typing import Callable, Dict, Any, Optional, List, Tuple


def create_openai_payload(messages: List[Dict[str, str]]) -> Dict[str, Any]:
    """
    OpenAI APIã«é€ä¿¡ã™ã‚‹ãŸã‚ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¾ã™ã€‚

    Args:
        messages (List[Dict[str, str]]): é€ä¿¡ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒªã‚¹ãƒˆã€‚å„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯è¾æ›¸å½¢å¼ã§ã€'role'ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ãŸã¯ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆï¼‰ã¨'content'ï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ï¼‰ã‚’å«ã¿ã¾ã™ã€‚

    Returns:
        Dict[str, Any]: OpenAI APIã«é€ä¿¡ã™ã‚‹ãŸã‚ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã€‚
    """
    return {"model": "gpt-4o", "messages": messages, "temperature": 0.7}


def send_openai_request(payload: Dict[str, Any], api_key: str) -> Tuple[Optional[Dict[str, Any]], Optional[str]]:
    """
    OpenAI APIã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã—ã¾ã™ã€‚

    Args:
        payload (Dict[str, Any]): OpenAI APIã«é€ä¿¡ã™ã‚‹ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã€‚
        api_key (str): OpenAI APIã‚­ãƒ¼ã€‚

    Returns:
        Tuple[Optional[Dict[str, Any]], Optional[str]]: æˆåŠŸã—ãŸå ´åˆã¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚€è¾æ›¸ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€‚
    """
    url = "https://api.openai.com/v1/chat/completions"
    headers = {"Authorization": f"Bearer {api_key}", "Content-Type": "application/json"}

    try:
        return httpx.post(url=url, headers=headers, json=payload, timeout=None).raise_for_status().json(), None
    except httpx.HTTPStatusError as exc:
        return None, f"Error while requesting. Status code: {exc.response.status_code}, Message: {exc.response.text}"


def chat_with_openai(
    api_request_func: Callable[[Dict[str, Any], str], Tuple[Optional[Dict[str, Any]], Optional[str]]],
    create_payload_func: Callable[[List[Dict[str, str]]], Dict[str, Any]],
    messages: List[Dict[str, str]],
    api_key: str,
) -> Optional[Dict[str, Any]]:
    """
    OpenAIã¨ãƒãƒ£ãƒƒãƒˆã‚’è¡Œã„ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å–å¾—ã—ã¾ã™ã€‚

    Args:
        api_request_func (Callable): APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹é–¢æ•°ã€‚
        create_payload_func (Callable): ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’ä½œæˆã™ã‚‹é–¢æ•°ã€‚
        messages (List[Dict[str, str]]): é€ä¿¡ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒªã‚¹ãƒˆã€‚
        api_key (str): OpenAI APIã‚­ãƒ¼ã€‚

    Returns:
        Optional[Dict[str, Any]]: æˆåŠŸã—ãŸå ´åˆã¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã€å¤±æ•—ã—ãŸå ´åˆã¯Noneã€‚
    """
    payload = create_payload_func(messages)
    response, error_message = api_request_func(payload, api_key)

    if error_message:
        display_error_message(error_message)
        return None

    return response


def receive_user_message() -> str:
    """
    ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®å…¥åŠ›ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–å¾—ã—ã¾ã™ã€‚

    Returns:
        str: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€‚
    """
    return input("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (`/end` ã§çµ‚äº†): ")


def display_message(message: str) -> None:
    """
    ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

    Args:
        message (str): ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€‚
    """
    print(f"LLM: {message}")


def display_error_message(error_message: str) -> None:
    """
    ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

    Args:
        error_message (str): è¡¨ç¤ºã™ã‚‹ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€‚
    """
    print(error_message)


def init_message() -> List[str]:
    """
    ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å±¥æ­´ã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚

    Returns:
        List[str]: ç©ºã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ãƒªã‚¹ãƒˆã€‚
    """
    return []


def update_message_history(messages: List[Dict[str, str]], new_message: Dict[str, str]) -> List[Dict[str, str]]:
    """
    ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ã«æ–°ã—ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ ã—ã¾ã™ã€‚

    Args:
        messages (List[Dict[str, str]]): ç¾åœ¨ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ã€‚
        new_message (Dict[str, str]): è¿½åŠ ã™ã‚‹æ–°ã—ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€‚

    Returns:
        List[Dict[str, str]]: æ›´æ–°ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ã€‚
    """
    return messages + [new_message]


def interact_with_llm_in_chat(api_key: str) -> None:
    """
    ãƒãƒ£ãƒƒãƒˆå½¢å¼ã§LLMã¨å¯¾è©±ã‚’è¡Œã„ã¾ã™ã€‚

    Args:
        api_key (str): OpenAI APIã‚­ãƒ¼ã€‚
    """
    messages = init_message()

    while True:
        user_message = receive_user_message()
        if user_message == "/end":
            break

        messages = update_message_history(messages=messages, new_message={"role": "user", "content": user_message})
        response = chat_with_openai(
            api_request_func=send_openai_request,
            create_payload_func=create_openai_payload,
            messages=messages,
            api_key=api_key,
        )

        if response is None:
            break

        if response:
            llm_message = response["choices"][0]["message"]["content"]
            messages = update_message_history(
                messages=messages, new_message={"role": "assistant", "content": llm_message}
            )

            display_message(llm_message)


if __name__ == "__main__":
    import os
    from dotenv import load_dotenv

    load_dotenv()
    interact_with_llm_in_chat(api_key=os.getenv("OPENAI_API_KEY"))
```
:::


# æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã«é™ã‚‰ãšã€é–¢æ•°ã®ã‚·ã‚°ãƒãƒãƒ£ã«ã€Œãã®é–¢æ•°ã¯ã©ã‚“ãªå‹ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰ã‚’å¼•æ•°ã¨ã—ã¦å—ã‘å–ã‚‹ã®ã‹ï¼Ÿã€ã€Œã©ã‚“ãªå‹ã‚’è¿”ã™ã®ã‹ï¼Ÿã€ãŒç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚
ã“ã‚Œã¾ã§å®Ÿè£…ã§ã¯ã€Pythonã®çµ„ã¿è¾¼ã¿å‹ã¨æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª `typing` ã‚’ä½¿ã£ã¦ãã¾ã—ãŸãŒã€ãƒ¦ãƒ¼ã‚¶å®šç¾©å‹ã‚’ä½¿ã†ã“ã¨ã§ã€é–¢æ•°ã‚·ã‚°ãƒãƒãƒ£ãŒç¤ºã™æƒ…å ±ã‚’å……å®Ÿã•ã›ã‚‹ã“ã¨ãŒå¿…è¦ã§ã™ã€‚
ãã®ãŸã‚ã€æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¨ã—ã¦ã¯ã€Pythonã®å‹ã‚·ã‚¹ãƒ†ãƒ ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€é–¢æ•°ã®ã‚·ã‚°ãƒãƒãƒ£ã‚’å……å®Ÿã•ã›ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚


